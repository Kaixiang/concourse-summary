<!DOCTYPE html>
<html>
  <head>
    <title><%= Time.now %> | Concourse Summary</title>
    <link rel="icon" type="image/png" href="https://buildpacks.ci.cf-app.com/public/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://buildpacks.ci.cf-app.com/public/favicons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="https://buildpacks.ci.cf-app.com/public/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://buildpacks.ci.cf-app.com/public/favicons/favicon-16x16.png" sizes="16x16">
    <style>
      body { margin:0; padding:0; font-family: sans-serif; font-size: 20px; line-height: 1.6em; }
      .outer { display:inline-block; width: 200px; height: 120px; color: white; background: #090; position: relative; margin: 8px; }
      .running { border: 7px solid yellow; box-sizing: border-box; outline: 3px solid #699; }
      .red { position: absolute; top:0; bottom: 0; left:0;  background: #900; }
      .inner { position: absolute; top:0; bottom: 0; left:0; right:0; text-align: center; text-decoration: none; }
      .inner { display: flex; justify-content: center; flex-direction: column; height: 120px; }
      .running .inner { height: 100px; }
    </style>
    <script src="https://cdn.rawgit.com/github/fetch/master/fetch.js"></script>
    <script>
      setInterval(function() {
        fetch(location.pathname, {credentials: 'same-origin'}).then(function(response) {
          return response.text()
        }).then(function(txt) {
          var doc = document.implementation.createHTMLDocument("example")
          doc.documentElement.innerHTML = txt
          document.head.innerHTML=doc.head.innerHTML
          document.body.innerHTML=doc.body.innerHTML
        }).catch(function(reason) {
          document.body.innerHTML="<h1>Error - " + Date() + "</h1><p>" + reason + "</p>"
        })
      }, 30000)
    </script>
  </head>
  <body>
    <div style="margin:0 8px"><%= Time.now %></div>

    <% statuses.each do |data| %>
    <a href="https://<%= host %><%= data.href %>" target="_blank" class="outer<%= data.running ? " running" : "" %>">
      <div class="red" style="width: <%= 100 - data.percent %>%;"></div>
      <div class="inner"><%= data.labels.join("<br>") %></div>
    </a>
    <% end %>

  </body>
</html>
